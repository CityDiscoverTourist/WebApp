<div>
  <div class="px-5" *rxLet="quest$ as vm">
    <div class="d-flex align-items-center justify-content-between mb-0 px-3">
      <div>
        <h6 style="margin-top: 12px">{{ vm.title }}</h6>
      </div>
      <div class="flex-fill"></div>
      <button
        style="
          background-color: rgb(76, 175, 80);
          color: rgb(255, 255, 255);
          transition: all 200ms ease 0s;
          padding: 5px 0px;
          display: inline-block;
          text-align: center;
          border-color: rgb(76, 175, 80);
        "
        class="btn btn-danger px-4 mt-2 me-3"
        (click)="onUpdateStatus(vm.id, 'Active')"
        [disabled]="vm.status == 'Active' ? true : false"
      >
        <i class="bi bi-arrow-counterclockwise"></i>
        Hoạt động
      </button>
      <button
        style="
          background-color: #cb2027;
          color: rgb(255, 255, 255);
          transition: all 200ms ease 0s;
          padding: 5px 0px;
          display: inline-block;
          text-align: center;
        "
        class="btn btn-danger px-4 mt-2 me-3"
        (click)="onUpdateStatus(vm.id, 'Inactive')"
        [disabled]="vm.status == 'Inactive' ? true : false"
      >
        <i class="bi bi-dash-circle-fill"></i>
        Ngừng hoạt động
      </button>
      <a
        class="btn btn-primary px-4 mt-2"
        style="
          color: rgb(255, 255, 255);
          transition: all 200ms ease 0s;
          padding: 5px 0px;
          display: inline-block;
          text-align: center;
        "
        [routerLink]="['./edit']"
        ><i class="bi bi-pencil-square"></i> Sửa quest</a
      >
    </div>
    <div class="row px-4 pt-2">
      <div class="card mb-1" style="border: 1px solid #fff">
        <div class="card-header bg-white" style="font-weight: 600">
          Thông tin quest
        </div>
        <div class="card-body" style="font-size: 0.8rem">
          <div
            class="row"
            style="font-size: 14px; font-weight: 500; line-height: 1.6rem"
          >
            <div class="col-2 mb-1">
              <div class="row-2 nowrap align-self-center">Id</div>
              <div class="row-2 nowrap">Giá</div>
              <div class="row-2 nowrap">Trạng thái</div>
              <div class="row-2 nowrap">Thời gian ước lượng</div>
              <div class="row-2 nowrap">Khoảng cách ước lượng</div>
              <div class="row-2 nowrap pt-2" style="font-weight: 500">
                <button
                  class="btn btn-sm btn-primary"
                  (click)="toggleDescription$.next()"
                >
                  Mô tả
                </button>
              </div>
            </div>

            <div class="col-2 mb-1" style="font-weight: 400">
              <div class="align-self-center row-2 nowrap">
                {{ vm.id }}
              </div>
              <div class="align-self-center row-2 nowrap">
                {{ vm.price | number }} đ
              </div>
              <div class="align-self-center row-2 nowrap">
                {{ vm.status == "Active" ? "Hoạt động" : "Ngừng hoạt động" }}
              </div>
              <div class="align-self-center row-2 nowrap">
                {{ vm.estimatedTime }} phút
              </div>
              <div class="align-self-center row-2 nowrap">
                {{ vm.estimatedDistance }} km
              </div>
            </div>
            <div class="col-3 mb-1">
              <div class="row-2 nowrap">Khu vực</div>
              <div class="row-2 nowrap">Loại quest</div>
              <div class="row-2 nowrap">Thời gian khả dụng</div>
              <div class="row-2 nowrap">Ngày tạo</div>
              <div class="row-2 nowrap">Ngày cập nhật cuối cùng</div>
            </div>
            <div class="col-2 mb-1" style="font-weight: 400">
              <div class="align-self-center row-2 nowrap">
                {{ vm.areaName }}
              </div>
              <div class="align-self-center row-2 nowrap">
                {{ vm.questTypeName }}
              </div>
              <div class="align-self-center row-2 nowrap">
                {{ vm.availableTime }}
              </div>
              <div class="align-self-center row-2 nowrap">
                {{ vm.createdDate | date: "dd/MM/yyyy" }}
              </div>
              <div class="align-self-center row-2 nowrap">
                {{ vm.updatedDate | date: "dd/MM/yyyy" }}
              </div>
            </div>
            <div class="col-3 mb-1">
              <div style="display: block">
                <div
                  style="width: 100%; display: flex; justify-content: center"
                >
                  <div *ngIf="vm?.imagePath">
                    <img
                      style="width: 120px; height: 120px"
                      src="{{ vm?.imagePath }}"
                      alt=""
                    />
                  </div>
                  <div class="d-grid" *ngIf="!vm?.imagePath">
                    <svg
                      class="MuiSvgIcon-root"
                      focusable="false"
                      viewBox="0 0 30 30"
                      aria-hidden="true"
                      style="
                        width: 90px;
                        height: 90px;
                        color: rgb(232, 234, 235);
                        margin: 0px auto;
                      "
                    >
                      <path
                        d="M2.8125 0H27.1875C28.7408 0 30 1.25918 30 2.8125V27.1875C30 28.7408 28.7408 30 27.1875 30H2.8125C1.25918 30 0 28.7408 0 27.1875V2.8125C0 1.25918 1.25918 0 2.8125 0ZM1.875 27.1875C1.875 27.7053 2.29471 28.125 2.8125 28.125H27.1875C27.7053 28.125 28.125 27.7053 28.125 27.1875V2.8125C28.125 2.29471 27.7053 1.875 27.1875 1.875H2.8125C2.29471 1.875 1.875 2.29471 1.875 2.8125V27.1875Z"
                        fill="currentColor"
                      ></path>
                      <path
                        d="M9.64686 16.2094C10.0125 15.8459 10.6031 15.8459 10.9687 16.2094L13.125 18.3657L17.1469 14.3438C17.5125 13.9803 18.103 13.9803 18.4687 14.3438L25.0312 20.9063C25.3937 21.276 25.3879 21.8696 25.0182 22.232C24.8462 22.4007 24.6159 22.4967 24.375 22.5001H5.62498C5.10725 22.503 4.68508 22.0858 4.68204 21.568C4.68057 21.3161 4.78053 21.0743 4.95936 20.8969L9.64686 16.2094Z"
                        fill="currentColor"
                      ></path>
                      <path
                        d="M12.1875 13.125C10.6342 13.125 9.375 11.8658 9.375 10.3125C9.375 8.7592 10.6342 7.5 12.1875 7.5C13.7408 7.5 15 8.7592 15 10.3125C15 11.8658 13.7408 13.125 12.1875 13.125Z"
                        fill="currentColor"
                      ></path>
                    </svg>
                    <p style="padding-top: 10px">
                      Quest này chưa có ảnh tải lên
                    </p>
                  </div>
                </div>
              </div>
            </div>
            <div
              class="mt-3"
              *ngIf="(description$ | async)?.showQuestDescription"
            >
              <div class="bd-callout bd-callout-info">
                {{ vm.description | descriptionPipe }}
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="px-5">
    <div class="d-flex align-items-center justify-content-between mt-2 px-3">
      <div class="flex-fill"></div>
      <a
        routerLink="./quest-item/create"
        class="btn btn-primary"
        style="min-width: 120px"
      >
        <i class="bi bi-plus"></i> Thêm câu hỏi
      </a>
    </div>
    <div class="bg-white mx-3 p-3 rounded mt-2">
      <div>
        <p>Câu hỏi</p>
      </div>
      <div class="rounded bg-white">
        <form [formGroup]="searchForm">
          <div class="d-flex">
            <div class="input-group me-3">
              <span
                class="input-group-text bg-white border-end-0"
                id="search-icon"
                ><i class="bi bi-search"></i
              ></span>
              <input
                type="text"
                class="border-start-0 form-control outline-none"
                style="width: 50px"
                placeholder="Tìm kiếm"
                aria-label="Tìm kiếm"
                aria-describedby="search-icon"
                formControlName="keyword"
                (keyup.enter)="searchQuestItem$.next(searchForm.value)"
              />
            </div>
            <ng-select
              [items]="questItemTypeIds | async"
              bindValue="id"
              bindLabel="name"
              placeholder="Chọn loại câu hỏi"
              [clearable]="true"
              [closeOnSelect]="true"
              style="min-width: 200px"
              formControlName="questItemTypeIds"
              class="me-3"
            ></ng-select>
            <div class="btn-group">
              <button
                type="button"
                class="btn btn-primary"
                style="min-width: 120px"
                (click)="submitSearch$.next(searchForm.value)"
              >
                <i class="bi bi-search"></i>
                Tìm kiếm
              </button>
              <button
                type="button"
                class="btn btn-default"
                style="min-width: 100px"
                (click)="resetSearch$.next()"
              >
                <i class="bi bi-x-lg"></i>
                Reset
              </button>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
  <div class="px-5">
    <div class="row pt-2 px-3 flex-wrap">
      <div
        class="col-sm-4"
        *ngFor="let q of questItems$ | async; let index; let i = index"
      >
        <div class="card mb-3">
          <div class="card-header bg-white py-3">
            <span style="font-weight: 600">Câu hỏi {{ i + 1 }}: </span>
            <span>{{ q.content }}</span>
          </div>
          <div class="card-body">
            <div class="row" *ngIf="q.questItemTypeId != 2">
              <div class="col-4">Đáp án text:</div>
              <div class="col-8">{{ q.rightAnswer }}</div>
            </div>

            <div class="row" *ngIf="q.questItemTypeId == 2">
              <div class="col-4">Đáp án ảnh:</div>
              <div class="col-8">
                <button
                  class="btn btn-sm btn-primary"
                  (click)="showImage(q.id)"
                >
                  Xem ảnh
                </button>
              </div>
            </div>

            <div class="row mt-3">
              <div class="col-4">Trạng thái:</div>
              <div class="col-8">
                {{ q.status == "Active" ? "Hoạt động" : "Ngừng hoạt động" }}
              </div>
            </div>
            <div class="row mt-3">
              <div class="col-4">Ngày tạo:</div>
              <div class="col-8">
                {{ q.createdDate | date: "dd/MM/yyyy" }}
              </div>
            </div>
            <div class="row mt-3">
              <div class="col-4">Thao tác</div>
              <div class="col-8">
                <button
                  class="btn btn-sm me-2"
                  style="
                    color: #fff;
                    background-color: #4caf50;
                    border-color: #4caf50;
                  "
                  type="button"
                  data-toggle="tooltip"
                  data-placement="top"
                  title="Edit"
                  (click)="onUpdate(q.id)"
                >
                  <i class="bi bi-pencil"></i>
                </button>
                <button
                  class="btn btn-sm me-2"
                  type="button"
                  style="
                    color: #fff;
                    background-color: #f44335;
                    border-color: #f44335;
                  "
                  data-toggle="tooltip"
                  data-placement="top"
                  title="Delete"
                  (click)="onDelete(q.id)"
                >
                  <i class="bi bi-trash3"></i>
                </button>
              </div>
            </div>

            <div class="row mt-3">
              <div class="col-4">Gợi ý:</div>
              <div class="col-8">
                <button
                  *ngIf="q.suggestions?.length != 0"
                  class="btn btn-primary btn-sm"
                  (click)="editSuggestion(q.suggestions[0].id)"
                >
                  Sửa
                </button>
                <button
                  *ngIf="q.suggestions?.length == 0"
                  class="btn btn-primary btn-sm"
                  (click)="showAddSuggestion(q.id)"
                >
                  Thêm
                </button>
              </div>
            </div>
            <router-outlet></router-outlet>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div *ngIf="questItems$ | async as vm" class="px-5">
    <div *ngIf="vm.length == 0" class="px-3">
      <div class="bd-callout bd-callout-info">
        Không có câu hỏi để hiển thị!
      </div>
    </div>
  </div>
  <div class="px-5">
    <div class="bg-white my-3 p-3 rounded">
      <div>
        <p>Phản hồi của khách hàng</p>
      </div>
      <div class="rounded bg-white">
        <form class="mb-4" [formGroup]="searchForm">
          <div class="d-flex">
            <div class="input-group me-3">
              <span
                class="input-group-text bg-white border-end-0"
                id="search-icon"
                ><i class="bi bi-search"></i
              ></span>
              <input
                type="text"
                class="border-start-0 form-control outline-none"
                placeholder="Tìm kiếm phản hồi theo thư điện tử"
                aria-label="Tìm kiếm phản hồi theo thư điện tử"
                aria-describedby="search-icon"
                formControlName="keyword"
                (keyup.enter)="searchComment$.next(searchFormComment.value)"
              />
            </div>
            <ng-select
              [items]="status"
              bindValue="value"
              bindLabel="id"
              style="min-width: 200px"
              placeholder="Chọn trạng thái"
              class="me-3"
              formControlName="status"
            ></ng-select>

            <button
              type="button"
              class="btn btn-primary"
              style="min-width: 120px"
              (click)="submitSearchComment$.next(searchForm.value)"
            >
              <i class="bi bi-search"></i>
              Tìm kiếm
            </button>
            <button
              type="button"
              class="btn btn-default"
              style="min-width: 100px"
              (click)="resetSearchComment$.next()"
            >
              <i class="bi bi-x-lg"></i>
              Reset
            </button>
          </div>
        </form>
        <div class="border overflow-hidden rouded shadow-sm">
          <ngx-datatable
            class="material rounded"
            [rows]="comments$ | async"
            [loadingIndicator]="(loading$ | async) === true"
            [columns]="columns"
            columnMode="force"
            [headerHeight]="50"
            [footerHeight]="50"
            [rowHeight]="50"
            [externalPaging]="true"
            [externalSorting]="true"
            [messages]="{
              emptyMessage: 'Không có phản hồi để hiển thị!',
              totalMessage: 'phản hồi'
            }"
            [count]="(metadataComment$ | async)?.totalCount || 0"
            [offset]="((metadataComment$ | async)?.currentPage || 0) - 1"
            [limit]="10"
            (page)="onPage($event)"
            (sort)="onSort($event)"
          >
            <ng-template #colCreatedAt let-value="value">
              {{ value | date: "dd/MM/yyyy" }}
            </ng-template>
            <ng-template #statusTemplate let-value="value" let-row="row">
              <span
                [ngStyle]="{
                  'background-color':
                    row.status == 'Active' ? '#4caf50' : '#cb2027',
                  color: '#fff',
                  transition: '200ms',
                  padding: '5px 0px',
                  display: 'inline-block',
                  'text-align': 'center',
                  width: '120px',
                  'border-radius': '9px'
                }"
                >{{
                  row.status == "Active" ? "Hoạt động" : "Ngừng hoạt động"
                }}</span
              >
            </ng-template>
            <ng-template #actionTemplate let-row="row" let-value="value">
              <button
                class="btn btn-sm me-2"
                style="
                  color: #fff;
                  background-color: #4caf50;
                  border-color: #4caf50;
                "
                type="button"
                data-toggle="tooltip"
                data-placement="top"
                placement="left"
                [disabled]="row.status == 'Active' ? true : false"
              >
                <i class="bi bi-arrow-counterclockwise"></i>
              </button>
              <button
                class="btn btn-sm me-2"
                type="button"
                [ngStyle]="
                  row.status == 'InActive'
                    ? {
                        color: '#fff',
                        backgroundColor: '#f44335',
                        borderColor: '#f44335'
                      }
                    : {
                        color: '#fff',
                        backgroundColor: '#f44335',
                        borderColor: '#f44335'
                      }
                "
                data-toggle="tooltip"
                data-placement="top"
                placement="left"
                [disabled]="row.status == 'Inactive' ? true : false"
              >
                <i class="bi bi-dash-circle-fill"></i>
              </button>
            </ng-template>
          </ngx-datatable>
        </div>
      </div>
    </div>
  </div>
</div>
